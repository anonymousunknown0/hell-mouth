<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Virtual Spiral Notebook</title>
  <style>
    /* ───── Base Styles ───── */
    body {
      margin: 0;
      background: #111 url('spiral.gif') center center fixed;
      background-size: cover;
      font-family: monospace;
      color: #eee;
      overflow-x: hidden;
      min-height: 100vh;
      transition: background 0.2s;
    }
    /* ───── Puzzle Grid ───── */
    .puzzle-grid {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 14px;
      padding: 30px 10px 140px 10px;
      z-index: 2;
    }
    .tile {
      position: relative;
      width: 190px; height: 106px;
      background: rgba(0,0,0,0.15);
      border: 2px solid #fff;
      border-radius: 20px;
      box-shadow: 0 0 16px #0008;
      cursor: pointer;
      overflow: hidden;
      transition: transform 0.18s, box-shadow 0.18s;
    }
    .tile img {
      width: 100%; height: 100%;
      object-fit: cover;
      opacity: 0.9;
      pointer-events: none;
    }
    .tile:hover {
      transform: scale(1.08);
      box-shadow: 0 0 26px #fff8;
      border-color: #ffd700;
      z-index: 5;
    }

    /* ───── Script‐Piece Styling ───── */
    /* apply galaxy.gif background, hide spiral.gif */
    .tile.script {
      background: url('galaxy.gif') center center / cover no-repeat;
      border-color: #ffd700;
    }
    .tile.script img {
      display: none;
    }
    .tile.script .tile-filename {
      color: #ffd700 !important;
    }

    /* ───── Filename Styling ───── */
    .tile-number {
      position: absolute;
      top: 8px; left: 12px;
      font-size: 1.4rem; font-weight: bold;
      color: #FFD600;
      text-shadow: 1px 1px 6px #000;
      pointer-events: none;
    }
    .tile-filename {
      position: absolute;
      bottom: 6px; left: 0;
      width: 100%;
      text-align: center;
      font-size: 0.85em; font-weight: bold;
      color: #FFD600;
      background: rgba(0,0,0,0.18);
      padding: 2px 4px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      pointer-events: none;
    }

    /* ───── Break-the-Spiral Button ───── */
    #break-btn {
      position: fixed;
      left: 50%; bottom: 32px;
      transform: translateX(-50%);
      font-size: 2em; font-weight: 900;
      color: #000; background: #fff;
      border: 4px solid #000; border-radius: 25px;
      padding: 12px 38px;
      cursor: pointer;
      box-shadow: 0 0 18px #0005;
      z-index: 1000;
      transition: background 0.2s, box-shadow 0.2s;
    }
    #break-btn:active {
      background: #000; color: #fff;
    }

    /* ───── Content Overlay ───── */
    #content {
      display: none;
      position: fixed; inset: 0;
      background: rgba(0,0,0,0.93);
      overflow-y: auto; -webkit-overflow-scrolling: touch;
      padding: 30px 10px; box-sizing: border-box;
      z-index: 20;
    }
    #content .filename {
      color: #ffd700;
      font-size: 1.2rem; font-weight: bold;
      margin-bottom: 12px; text-align: center;
      word-break: break-all;
    }
    #content-area {
      width: 100%; max-width: 700px;
      margin: 0 auto; overflow-y: auto;
      max-height: calc(100vh - 200px);
    }
    #content-area pre {
      background: #111; color: #fff;
      padding: 24px; border-radius: 14px;
      font-family: 'Courier New', Courier, monospace;
      font-size: 1.05em; line-height: 1.5;
      white-space: pre-wrap; word-break: break-word;
      box-shadow: 0 0 12px #0008;
      margin-bottom: 16px;
    }
    #content-area audio, #content-area video {
      width: 100%; max-width: 700px;
      border-radius: 12px; box-shadow: 0 0 12px #0008;
      margin-bottom: 16px;
    }
    .close-btn, .copy-btn {
      display: block; margin: 8px auto;
      padding: 8px 24px; font-size: 1em; font-weight: bold;
      border: 2px solid #fff; border-radius: 12px;
      cursor: pointer; outline: none;
      transition: background 0.2s;
    }
    .close-btn { background: rgba(0,0,0,0.5); color: #fff; }
    .close-btn:hover { background: #e00; }
    .copy-btn { background: #ffd700; color: #111; border-color: #ffd700; }
    .copy-btn:active { background: #ffc107; }

    @keyframes smashFlash { from{background:#111;} to{background:#fff;} }

    @media (max-width:800px) {
      .tile { width:92vw; height:20vw; min-height:80px; }
      #break-btn { font-size:1.4em; padding:8px 24px; bottom:12px; }
    }
  </style>
</head>
<body>

  <audio id="click-sound" src="click.mp3" preload="auto"></audio>

  <div class="puzzle-grid" id="puzzle-grid"></div>

  <button id="break-btn">BREAK THE SPIRAL</button>

  <div id="content">
    <div class="filename" id="file-name"></div>
    <div id="content-area"></div>
    <button class="close-btn" onclick="closeContent()">CLOSE</button>
  </div>

  <script>
    // ───── File List ─────
    const files = [
      /* your full array from before, including the newly added ones */
      "The Surveillance Tape.mp4",
      // … all existing entries …
      "are you listening_watching.mp4"
    ];

    // ───── Click‐sound helper ─────
    let hasClicked = false;
    function playClickOnce() {
      if (!hasClicked) {
        hasClicked = true;
        const audio = document.getElementById('click-sound');
        audio.currentTime = 0;
        audio.play();
      }
    }

    // ───── Infinite Audio Mashup ─────
    let mashupPlayer = new Audio();
    let smashIndex = 0;
    let smashTimeout;
    let smashing = false;

    function smashNext() {
      const file = files[smashIndex];
      mashupPlayer.src = file;
      mashupPlayer.playbackRate = 1.25;
      mashupPlayer.currentTime = 0;
      mashupPlayer.play();
      smashTimeout = setTimeout(() => {
        smashIndex = (smashIndex + 1) % files.length;
        smashNext();
      }, 7000);
    }

    function smashFuckAll() {
      // toggle
      if (smashing) {
        smashing = false;
        clearTimeout(smashTimeout);
        mashupPlayer.pause();
        document.getElementById('break-btn').textContent = "BREAK THE SPIRAL";
        document.body.style.animation = "";
      } else {
        smashing = true;
        smashIndex = 0;
        document.getElementById('break-btn').textContent = "STOP SPIRAL";
        document.body.style.animation = "smashFlash 0.3s alternate infinite";
        smashNext();
      }
    }

    document.getElementById('break-btn').onclick = smashFuckAll;

    // ───── Content Viewer ─────
    let currentScriptText = "";
    function escapeHTML(str) {
      return str.replace(/[&<>"']/g, m => ({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' })[m]);
    }
    function openFile(file, idx) {
      playClickOnce();
      if (smashing) smashFuckAll();
      const grid = document.getElementById('puzzle-grid');
      const content = document.getElementById('content');
      const area = document.getElementById('content-area');
      document.getElementById('file-name').innerText = file;
      area.innerHTML = "";
      const ext = file.split('.').pop().toLowerCase();
      if (['mp3','wav','m4a'].includes(ext) || ['mp4','mov'].includes(ext)) {
        // audio/video unified
        area.innerHTML = `<audio controls autoplay loop src="${file}"></audio>`;
      } else {
        // .script.txt or other text
        area.innerHTML = `<div style="color:#fff;">Loading script…</div>`;
        fetch(file).then(r => r.text()).then(txt => {
          currentScriptText = txt;
          area.innerHTML = `
            <pre>${escapeHTML(txt)}</pre>
            <button class="copy-btn" onclick="copyScript()">COPY SCRIPT</button>
          `;
        });
      }
      grid.style.display = "none";
      content.style.display = "flex";
    }
    function closeContent() {
      document.getElementById('content').style.display = "none";
      document.getElementById('puzzle-grid').style.display = "flex";
      document.querySelectorAll('#content-area audio, #content-area video').forEach(m => {
        if (m.pause) { m.pause(); m.currentTime = 0; }
      });
    }
    function copyScript() {
      if (!currentScriptText) return;
      navigator.clipboard.writeText(currentScriptText);
      alert('Script copied!');
    }

    // ───── Render Tiles ─────
    function displayTiles() {
      const grid = document.getElementById('puzzle-grid');
      grid.innerHTML = files.map((f, i) => {
        // add .script to the tile if it's a .script.txt
        const isScript = f.endsWith('.script.txt');
        return `
          <div class="tile${isScript ? ' script' : ''}"
               onclick="openFile('${f.replace(/'/g,"\\'")}', ${i})">
            <div class="tile-number">${i+1}</div>
            <img src="spiral.gif" alt="spiral"/>
            <div class="tile-filename${isScript ? ' script-file' : ''}">${f}</div>
          </div>
        `;
      }).join('');
    }

    displayTiles();
  </script>
</body>
</html>