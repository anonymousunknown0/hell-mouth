<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Virtual Spiral Notebook</title>
  <style>
    /* ─── Base & Background ─────────────────────────────────────────────────*/
    body {
      margin: 0;
      background: #111 url('spiral.gif') center center fixed;
      background-size: cover;
      font-family: monospace;
      color: #eee;
      overflow-x: hidden;      /* allow vertical scroll */
      overflow-y: auto;
      transition: background 0.2s;
    }

    /* ─── Emotion Overlay ───────────────────────────────────────────────────*/
    #emotion-overlay {
      position: fixed; inset: 0;
      background: rgba(0,0,0,0.95);
      display: flex; align-items: center; justify-content: center;
      z-index: 2000;
    }
    /* ...emotion wheel CSS unchanged... */

    /* ─── Puzzle Grid & Tiles ─────────────────────────────────────────────*/
    .puzzle-grid {
      display: flex; flex-wrap: wrap; justify-content: center;
      gap: 14px; padding: 30px 10px 140px; z-index: 2;
    }
    /* ...tile styling unchanged... */

    /* ─── Break Button ────────────────────────────────────────────────────*/
    #break-btn { /* unchanged */ }

    /* ─── Content Overlay ─────────────────────────────────────────────────*/
    #content {
      display: none;           /* will be set to flex in JS */
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.93);
      /* new flex setup: stack content vertically, centered */
      display: flex;
      flex-direction: column;
      align-items: center;
      overflow-y: auto;
      padding: 80px 10px 30px; /* extra top padding to clear headers */
      z-index: 20;
      box-sizing: border-box;
    }
    #content .filename {
      /* unchanged */
    }
    #content-area pre,
    #content-area audio,
    #content-area video {
      /* unchanged */
    }
    .close-btn,
    .copy-btn {
      /* unchanged */
    }

    /* ─── Media Queries & Keyframes ───────────────────────────────────────*/
    @media (max-width:800px) {
      /* unchanged */
    }
    @keyframes smashFlash { from{background:#111;} to{background:#fff;} }
  </style>
</head>
<body>

  <!-- Emotion Selection Overlay -->
  <div id="emotion-overlay">
    <div id="emotion-wheel">
      <img src="assets/emotional-wheel.png" alt="Select Your Emotion"/>
      <div class="emotion-btn" data-emotion="Joy">Joy</div>
      <div class="emotion-btn" data-emotion="Trust">Trust</div>
      <div class="emotion-btn" data-emotion="Fear">Fear</div>
      <div class="emotion-btn" data-emotion="Surprise">Surprise</div>
      <div class="emotion-btn" data-emotion="Sadness">Sadness</div>
      <div class="emotion-btn" data-emotion="Disgust">Disgust</div>
      <div class="emotion-btn" data-emotion="Anger">Anger</div>
      <div class="emotion-btn" data-emotion="Anticipation">Anticipation</div>
    </div>
  </div>

  <!-- Click Sound -->
  <audio id="click-sound" src="click.mp3" preload="auto"></audio>

  <!-- Puzzle Grid Container -->
  <div class="puzzle-grid" id="puzzle-grid"></div>

  <!-- Break the Spiral Button -->
  <button id="break-btn">BREAK THE SPIRAL</button>

  <!-- Content Viewer Overlay -->
  <div id="content">
    <div class="filename" id="file-name"></div>
    <div id="content-area"></div>
    <button class="close-btn" onclick="closeContent()">CLOSE</button>
  </div>

  <script>
    // ─── File List ─────────────────────────────────────────────────────────
    const files = [
      "The Surveillance Tape.mp4",
      "choose your player.mp4",
      "hellmouth part one_1.mp4",
      "333_leaked_therapy_smaller.mp4",
      "go_gay_outro.script.txt",
      "lunch with the narrator.script.txt",
      "choose your player.script.txt",
      "disclaimers.script.txt",
      "why call tmz harvey levin.script.txt",
      "confession press conference.script.txt",
      "3 cock anatomy.mp4",
      "why calls from gaga are SO important.script.txt",
      "5 hypnotize.mp4",
      "6 macbook air.mp4",
      "why calls from YE are SO important.script.txt",
      "7 male body.mp4",
      "9 microchip.mp4",
      "11 old school smoking.mp4",
      "12 sperm microscope.mp4",
      "17 heart.mp4",
      "18 empty room.mp4",
      "19 tangled thoughts.mp4",
      "20 black void.mp4",
      "21 shattered mirror.mp4",
      "24 hands.mp4",
      "25 pulse.mp4",
      "29 ringing.mp4",
      "30 heartbeat.mp4",
      "31 white noise.mp4",
      "32 static.mp4",
      "33 data leak.mp4",
      "34 confession tape.mp4",
      "35 inside my head.mp4",
      "36 memory glitch.mp4",
      "37 low battery.mp4",
      "38 server crash.mp4",
      "39 corrupted file.mp4",
      "40 demon deal.script.txt",
      "41 exorcism intro.script.txt",
      "42 possessed.mp4",
      "43 ritual chant.mp4",
      "44 price of fame.script.txt",
      "45 sold soul.mp4",
      "46 digital holy water.mp4",
      "47 to write love....mp4",
      "48 script break.script.txt",
      "49 black hole.mp4",
      "50 spiral echo.mp4",
      "51 press press press press press.mp4",
      "suffer suffer suffer.mp4",
      "welcome to your fantasy.mp4",
      "the tmz shame spiral.mp4",
      "you need to know.mp4",
      "you and i are bored.mp4",
      "the most hated man alive.mp4",
      "television visions.mp4",
      "hyper focused hyper relaxed.mp4",
      "headphones baby.mp4",
      "do you understand.mp4",
      "bieber with sound.mp4",
      "behind the scenes.mp4",
      "are you listening_watching.mp4"
    ];

    // ─── Emotion Overlay Logic ─────────────────────────────────────────────
    document.querySelectorAll('.emotion-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        document.getElementById('emotion-overlay').style.display = 'none';
      });
    });

    // ─── Click Sound Helper ────────────────────────────────────────────────
    let hasClicked = false;
    function playClickOnce() {
      if (!hasClicked) {
        hasClicked = true;
        const audio = document.getElementById('click-sound');
        audio.currentTime = 0;
        audio.play();
      }
    }

    // ─── Infinite Audio Mashup ─────────────────────────────────────────────
    let mashupPlayer = new Audio();
    let smashIndex = 0;
    let smashTimeout, smashing = false;

    function smashNext() {
      const file = files[smashIndex];
      mashupPlayer.src = file;
      mashupPlayer.playbackRate = 1.25;
      mashupPlayer.currentTime = 0;
      mashupPlayer.play();
      smashTimeout = setTimeout(() => {
        smashIndex = (smashIndex + 1) % files.length;
        smashNext();
      }, 7000);
    }

    function smashFuckAll() {
      if (smashing) {
        smashing = false;
        clearTimeout(smashTimeout);
        mashupPlayer.pause();
        document.getElementById('break-btn').textContent = "BREAK THE SPIRAL";
        document.body.style.animation = "";
      } else {
        smashing = true;
        smashIndex = 0;
        document.getElementById('break-btn').textContent = "STOP SPIRAL";
        document.body.style.animation = "smashFlash 0.3s alternate infinite";
        smashNext();
      }
    }
    document.getElementById('break-btn').onclick = smashFuckAll;

    // ─── Content Viewer ────────────────────────────────────────────────────
    let currentScriptText = "";
    function escapeHTML(str) {
      return str.replace(/[&<>"']/g, m => ({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' })[m]);
    }
    function openFile(file, idx) {
      playClickOnce();
      if (smashing) smashFuckAll();
      document.getElementById('file-name').innerText = file;
      const area = document.getElementById('content-area');
      area.innerHTML = "";
      const ext = file.split('.').pop().toLowerCase();
      if (['mp3','wav','m4a','mp4','mov'].includes(ext)) {
        area.innerHTML = `<audio controls autoplay loop src="${file}"></audio>`;
      } else {
        area.innerHTML = `<div>Loading…</div>`;
        fetch(file).then(r => r.text()).then(txt => {
          currentScriptText = txt;
          area.innerHTML = `
            <pre>${escapeHTML(txt)}</pre>
            <button class="copy-btn" onclick="copyScript()">COPY SCRIPT</button>
          `;
        });
      }
      document.getElementById('puzzle-grid').style.display = "none";
      document.getElementById('content').style.display = "flex";
    }
    function closeContent() {
      document.getElementById('content').style.display = "none";
      document.getElementById('puzzle-grid').style.display = "flex";
      document.querySelectorAll('#content-area audio, #content-area video').forEach(m => {
        if (m.pause) { m.pause(); m.currentTime = 0; }
      });
    }
    function copyScript() {
      if (currentScriptText) {
        navigator.clipboard.writeText(currentScriptText);
        alert('Script copied!');
      }
    }

    // ─── Render Tiles ───────────────────────────────────────────────────────
    function displayTiles() {
      const grid = document.getElementById('puzzle-grid');
      grid.innerHTML = files.map((f,i) => {
        const isScript = f.endsWith('.script.txt');
        return `
          <div class="tile${isScript?' script':''}"
               onclick="openFile('${f.replace(/'/g,"\\'")}',${i})">
            <div class="tile-number">${i+1}</div>
            <img src="spiral.gif" alt="spiral"/>
            <div class="tile-filename">${f}</div>
          </div>
        `;
      }).join('');
    }

    displayTiles();
  </script>
</body>
</html>